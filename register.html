<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SRMS - Student Register</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="login.css" />
</head>
<body>
    <div class="page-wrapper">
        <header class="header">
            <div class="logo-icon">S</div>
            <div class="loo-text">
                <div class="logo-title">SRMS</div>
                <div class="logo-subtitle">STUDENT REGISTRATION &amp; ACADEMIC MANAGEMENT SYSTEM</div>
            </div>
        </header>

        <main class="main">
            <section class="card" aria-label="student registration form">
                <!-- back links moved to bottom for easier access on mobile and desktop -->

                <div class="card-header">
                    <h1 class="card-title">STUDENT REGISTER</h1>
                    <p class="card-subtitle">Create your account to access the dashboard, results and attendance.</p>
                </div>

                <form id="register-form" novalidate>
                    <div class="form-group">
                        <label class="form-label" for="schoolEmail">School / University Email</label>
                        <div class="input-wrapper">
                            <input id="schoolEmail" name="schoolEmail" type="email" class="input-field" placeholder="you@school.edu" required />
                        </div>
                        <div class="form-error" id="err-schoolEmail" hidden></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="firstName">First Name</label>
                        <div class="input-wrapper">
                            <input id="firstName" name="firstName" type="text" class="input-field" placeholder="First name" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="middleName">Middle Name</label>
                        <div class="input-wrapper">
                            <input id="middleName" name="middleName" type="text" class="input-field" placeholder="Middle name" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="lastName">Last Name</label>
                        <div class="input-wrapper">
                            <input id="lastName" name="lastName" type="text" class="input-field" placeholder="Last name" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="studentId">Student ID</label>
                        <div class="input-wrapper">
                            <input id="studentId" name="studentId" type="text" class="input-field" placeholder="e.g. 2025-04-12223" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="phone">Phone Number</label>
                        <div class="input-wrapper">
                            <!-- replaced single input with country code select + local number input -->
                            <div class="phone-row" style="display:flex; gap:0.5rem; align-items:center;">
                                <select id="countryCode" class="input-field country-code" aria-label="Country code" required>
                                    <option value="">Select country code</option>
                                </select>
                                <input id="phoneNumber" name="phoneNumber" type="tel" class="input-field phone-number" placeholder="7XXXXXXXX" required />
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="year">Year of Registration</label>
                        <div class="input-wrapper">
                            <select id="year" name="year" class="input-field" required>
                                <option value="">Select year</option>
                                <option>2022</option>
                                <option>2023</option>
                                <option>2024</option>
                                <option>2025</option>
                                <option>2026</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="program">Program / Course (optional)</label>
                        <div class="input-wrapper">
                            <input id="program" name="program" type="text" class="input-field" placeholder="e.g. BSc Computer Science" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="regPassword">Password</label>
                        <div class="input-wrapper">
                            <input id="regPassword" name="regPassword" type="password" class="input-field" placeholder="Create a password" required />
                            <button type="button" class="input-eye" aria-label="Show password">üëÅÔ∏è</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="confirmPassword">Confirm Password</label>
                        <div class="input-wrapper">
                            <input id="confirmPassword" name="confirmPassword" type="password" class="input-field" placeholder="Confirm password" required />
                            <button type="button" class="input-eye" aria-label="Show password">üëÅÔ∏è</button>
                        </div>
                        <div class="form-error" id="err-password" hidden></div>
                    </div>

                    <div class="helper-row" style="margin-top:0.6rem;">
                        <button type="submit" class="btn-primary">Create Account</button>
                    </div>
                </form>

                <div class="demo-section" style="margin-top:1rem; text-align:center;">
                    Already registered? <a href="student-login.html">Sign in here</a>
                </div>
                <!-- Bottom fixed back links: left -> Back to Login, right -> Back to Home -->
                <a href="student-login.html" class="back-link back-left"><span>&larr;</span> Back to Login</a>
                <a href="index.html" class="back-link back-right">Back to Home <span>&rarr;</span></a>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // password toggle
    document.querySelectorAll('.input-eye').forEach(btn => {
        btn.addEventListener('click', () => {
            const input = btn.previousElementSibling;
            if (!input) return;
            input.type = input.type === 'password' ? 'text' : 'password';
            btn.textContent = input.type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            input.focus();
        });
    });

    // DOM refs
    const countrySelect = document.getElementById('countryCode');
    // stable placeholder
    countrySelect.innerHTML = '<option value="">Select country code</option>';
    const phoneNumberInput = document.getElementById('phoneNumber');
    const form = document.getElementById('register-form');
    const errEmail = document.getElementById('err-schoolEmail');
    const errPassword = document.getElementById('err-password');

    function showError(el, msg) { if (!el) return; el.textContent = msg; el.hidden = false; }
    function clearError(el) { if (!el) return; el.hidden = true; }

    // Full alphabetic list of countries + calling codes (includes Tanzania)
    const countries = [
        { name: "Afghanistan", code: "+93", iso2: "AF" },
        { name: "Albania", code: "+355", iso2: "AL" },
        { name: "Algeria", code: "+213", iso2: "DZ" },
        { name: "Andorra", code: "+376", iso2: "AD" },
        { name: "Angola", code: "+244", iso2: "AO" },
        { name: "Antigua and Barbuda", code: "+1-268", iso2: "AG" },
        { name: "Argentina", code: "+54", iso2: "AR" },
        { name: "Armenia", code: "+374", iso2: "AM" },
        { name: "Australia", code: "+61", iso2: "AU" },
        { name: "Austria", code: "+43", iso2: "AT" },
        { name: "Azerbaijan", code: "+994", iso2: "AZ" },
        { name: "Bahamas", code: "+1-242", iso2: "BS" },
        { name: "Bahrain", code: "+973", iso2: "BH" },
        { name: "Bangladesh", code: "+880", iso2: "BD" },
        { name: "Barbados", code: "+1-246", iso2: "BB" },
        { name: "Belarus", code: "+375", iso2: "BY" },
        { name: "Belgium", code: "+32", iso2: "BE" },
        { name: "Belize", code: "+501", iso2: "BZ" },
        { name: "Benin", code: "+229", iso2: "BJ" },
        { name: "Bhutan", code: "+975", iso2: "BT" },
        { name: "Bolivia", code: "+591", iso2: "BO" },
        { name: "Bosnia and Herzegovina", code: "+387", iso2: "BA" },
        { name: "Botswana", code: "+267", iso2: "BW" },
        { name: "Brazil", code: "+55", iso2: "BR" },
        { name: "Brunei", code: "+673", iso2: "BN" },
        { name: "Bulgaria", code: "+359", iso2: "BG" },
        { name: "Burkina Faso", code: "+226", iso2: "BF" },
        { name: "Burundi", code: "+257", iso2: "BI" },
        { name: "Cabo Verde", code: "+238", iso2: "CV" },
        { name: "Cambodia", code: "+855", iso2: "KH" },
        { name: "Cameroon", code: "+237", iso2: "CM" },
        { name: "Canada", code: "+1", iso2: "CA" },
        { name: "Central African Republic", code: "+236", iso2: "CF" },
        { name: "Chad", code: "+235", iso2: "TD" },
        { name: "Chile", code: "+56", iso2: "CL" },
        { name: "China", code: "+86", iso2: "CN" },
        { name: "Colombia", code: "+57", iso2: "CO" },
        { name: "Comoros", code: "+269", iso2: "KM" },
        { name: "Congo (Republic)", code: "+242", iso2: "CG" },
        { name: "Congo (DRC)", code: "+243", iso2: "CD" },
        { name: "Costa Rica", code: "+506", iso2: "CR" },
        { name: "C√¥te d‚ÄôIvoire", code: "+225", iso2: "CI" },
        { name: "Croatia", code: "+385", iso2: "HR" },
        { name: "Cuba", code: "+53", iso2: "CU" },
        { name: "Cyprus", code: "+357", iso2: "CY" },
        { name: "Czechia", code: "+420", iso2: "CZ" },
        { name: "Denmark", code: "+45", iso2: "DK" },
        { name: "Djibouti", code: "+253", iso2: "DJ" },
        { name: "Dominica", code: "+1-767", iso2: "DM" },
        { name: "Dominican Republic", code: "+1-809", iso2: "DO" },
        { name: "Ecuador", code: "+593", iso2: "EC" },
        { name: "Egypt", code: "+20", iso2: "EG" },
        { name: "El Salvador", code: "+503", iso2: "SV" },
        { name: "Equatorial Guinea", code: "+240", iso2: "GQ" },
        { name: "Eritrea", code: "+291", iso2: "ER" },
        { name: "Estonia", code: "+372", iso2: "EE" },
        { name: "Eswatini", code: "+268", iso2: "SZ" },
        { name: "Ethiopia", code: "+251", iso2: "ET" },
        { name: "Fiji", code: "+679", iso2: "FJ" },
        { name: "Finland", code: "+358", iso2: "FI" },
        { name: "France", code: "+33", iso2: "FR" },
        { name: "Gabon", code: "+241", iso2: "GA" },
        { name: "Gambia", code: "+220", iso2: "GM" },
        { name: "Georgia", code: "+995", iso2: "GE" },
        { name: "Germany", code: "+49", iso2: "DE" },
        { name: "Ghana", code: "+233", iso2: "GH" },
        { name: "Greece", code: "+30", iso2: "GR" },
        { name: "Grenada", code: "+1-473", iso2: "GD" },
        { name: "Guatemala", code: "+502", iso2: "GT" },
        { name: "Guinea", code: "+224", iso2: "GN" },
        { name: "Guinea-Bissau", code: "+245", iso2: "GW" },
        { name: "Guyana", code: "+592", iso2: "GY" },
        { name: "Haiti", code: "+509", iso2: "HT" },
        { name: "Honduras", code: "+504", iso2: "HN" },
        { name: "Hungary", code: "+36", iso2: "HU" },
        { name: "Iceland", code: "+354", iso2: "IS" },
        { name: "India", code: "+91", iso2: "IN" },
        { name: "Indonesia", code: "+62", iso2: "ID" },
        { name: "Iran", code: "+98", iso2: "IR" },
        { name: "Iraq", code: "+964", iso2: "IQ" },
        { name: "Ireland", code: "+353", iso2: "IE" },
        { name: "Israel", code: "+972", iso2: "IL" },
        { name: "Italy", code: "+39", iso2: "IT" },
        { name: "Jamaica", code: "+1-876", iso2: "JM" },
        { name: "Japan", code: "+81", iso2: "JP" },
        { name: "Jordan", code: "+962", iso2: "JO" },
        { name: "Kazakhstan", code: "+7", iso2: "KZ" },
        { name: "Kenya", code: "+254", iso2: "KE" },
        { name: "Kiribati", code: "+686", iso2: "KI" },
        { name: "Kuwait", code: "+965", iso2: "KW" },
        { name: "Kyrgyzstan", code: "+996", iso2: "KG" },
        { name: "Laos", code: "+856", iso2: "LA" },
        { name: "Latvia", code: "+371", iso2: "LV" },
        { name: "Lebanon", code: "+961", iso2: "LB" },
        { name: "Lesotho", code: "+266", iso2: "LS" },
        { name: "Liberia", code: "+231", iso2: "LR" },
        { name: "Libya", code: "+218", iso2: "LY" },
        { name: "Liechtenstein", code: "+423", iso2: "LI" },
        { name: "Lithuania", code: "+370", iso2: "LT" },
        { name: "Luxembourg", code: "+352", iso2: "LU" },
        { name: "Madagascar", code: "+261", iso2: "MG" },
        { name: "Malawi", code: "+265", iso2: "MW" },
        { name: "Malaysia", code: "+60", iso2: "MY" },
        { name: "Maldives", code: "+960", iso2: "MV" },
        { name: "Mali", code: "+223", iso2: "ML" },
        { name: "Malta", code: "+356", iso2: "MT" },
        { name: "Marshall Islands", code: "+692", iso2: "MH" },
        { name: "Mauritania", code: "+222", iso2: "MR" },
        { name: "Mauritius", code: "+230", iso2: "MU" },
        { name: "Mexico", code: "+52", iso2: "MX" },
        { name: "Micronesia", code: "+691", iso2: "FM" },
        { name: "Moldova", code: "+373", iso2: "MD" },
        { name: "Monaco", code: "+377", iso2: "MC" },
        { name: "Mongolia", code: "+976", iso2: "MN" },
        { name: "Montenegro", code: "+382", iso2: "ME" },
        { name: "Morocco", code: "+212", iso2: "MA" },
        { name: "Mozambique", code: "+258", iso2: "MZ" },
        { name: "Myanmar", code: "+95", iso2: "MM" },
        { name: "Namibia", code: "+264", iso2: "NA" },
        { name: "Nauru", code: "+674", iso2: "NR" },
        { name: "Nepal", code: "+977", iso2: "NP" },
        { name: "Netherlands", code: "+31", iso2: "NL" },
        { name: "New Zealand", code: "+64", iso2: "NZ" },
        { name: "Nicaragua", code: "+505", iso2: "NI" },
        { name: "Niger", code: "+227", iso2: "NE" },
        { name: "Nigeria", code: "+234", iso2: "NG" },
        { name: "North Korea", code: "+850", iso2: "KP" },
        { name: "North Macedonia", code: "+389", iso2: "MK" },
        { name: "Norway", code: "+47", iso2: "NO" },
        { name: "Oman", code: "+968", iso2: "OM" },
        { name: "Pakistan", code: "+92", iso2: "PK" },
        { name: "Palau", code: "+680", iso2: "PW" },
        { name: "Panama", code: "+507", iso2: "PA" },
        { name: "Papua New Guinea", code: "+675", iso2: "PG" },
        { name: "Paraguay", code: "+595", iso2: "PY" },
        { name: "Peru", code: "+51", iso2: "PE" },
        { name: "Philippines", code: "+63", iso2: "PH" },
        { name: "Poland", code: "+48", iso2: "PL" },
        { name: "Portugal", code: "+351", iso2: "PT" },
        { name: "Qatar", code: "+974", iso2: "QA" },
        { name: "Romania", code: "+40", iso2: "RO" },
        { name: "Russia", code: "+7", iso2: "RU" },
        { name: "Rwanda", code: "+250", iso2: "RW" },
        { name: "Saint Kitts and Nevis", code: "+1-869", iso2: "KN" },
        { name: "Saint Lucia", code: "+1-758", iso2: "LC" },
        { name: "Saint Vincent and the Grenadines", code: "+1-784", iso2: "VC" },
        { name: "Samoa", code: "+685", iso2: "WS" },
        { name: "San Marino", code: "+378", iso2: "SM" },
        { name: "Sao Tome and Principe", code: "+239", iso2: "ST" },
        { name: "Saudi Arabia", code: "+966", iso2: "SA" },
        { name: "Senegal", code: "+221", iso2: "SN" },
        { name: "Serbia", code: "+381", iso2: "RS" },
        { name: "Seychelles", code: "+248", iso2: "SC" },
        { name: "Sierra Leone", code: "+232", iso2: "SL" },
        { name: "Singapore", code: "+65", iso2: "SG" },
        { name: "Slovakia", code: "+421", iso2: "SK" },
        { name: "Slovenia", code: "+386", iso2: "SI" },
        { name: "Solomon Islands", code: "+677", iso2: "SB" },
        { name: "Somalia", code: "+252", iso2: "SO" },
        { name: "South Africa", code: "+27", iso2: "ZA" },
        { name: "South Korea", code: "+82", iso2: "KR" },
        { name: "South Sudan", code: "+211", iso2: "SS" },
        { name: "Spain", code: "+34", iso2: "ES" },
        { name: "Sri Lanka", code: "+94", iso2: "LK" },
        { name: "Sudan", code: "+249", iso2: "SD" },
        { name: "Suriname", code: "+597", iso2: "SR" },
        { name: "Sweden", code: "+46", iso2: "SE" },
        { name: "Switzerland", code: "+41", iso2: "CH" },
        { name: "Syria", code: "+963", iso2: "SY" },
        { name: "Taiwan", code: "+886", iso2: "TW" },
        { name: "Tajikistan", code: "+992", iso2: "TJ" },
        { name: "Tanzania", code: "+255", iso2: "TZ" },
        { name: "Thailand", code: "+66", iso2: "TH" },
        { name: "Timor-Leste", code: "+670", iso2: "TL" },
        { name: "Togo", code: "+228", iso2: "TG" },
        { name: "Tonga", code: "+676", iso2: "TO" },
        { name: "Trinidad and Tobago", code: "+1-868", iso2: "TT" },
        { name: "Tunisia", code: "+216", iso2: "TN" },
        { name: "Turkey", code: "+90", iso2: "TR" },
        { name: "Turkmenistan", code: "+993", iso2: "TM" },
        { name: "Tuvalu", code: "+688", iso2: "TV" },
        { name: "Uganda", code: "+256", iso2: "UG" },
        { name: "Ukraine", code: "+380", iso2: "UA" },
        { name: "United Arab Emirates", code: "+971", iso2: "AE" },
        { name: "United Kingdom", code: "+44", iso2: "GB" },
        { name: "United States", code: "+1", iso2: "US" },
        { name: "Uruguay", code: "+598", iso2: "UY" },
        { name: "Uzbekistan", code: "+998", iso2: "UZ" },
        { name: "Vanuatu", code: "+678", iso2: "VU" },
        { name: "Vatican City", code: "+379", iso2: "VA" },
        { name: "Venezuela", code: "+58", iso2: "VE" },
        { name: "Vietnam", code: "+84", iso2: "VN" },
        { name: "Yemen", code: "+967", iso2: "YE" },
        { name: "Zambia", code: "+260", iso2: "ZM" },
        { name: "Zimbabwe", code: "+263", iso2: "ZW" }
    ];

    // Populate the select from the countries array (alphabetical)
    function populateList(list) {
        const final = list.slice().sort((a,b) => a.name.localeCompare(b.name));
        countrySelect.innerHTML = '<option value="">Select country code</option>';
        final.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.code;
            opt.textContent = `${c.name} (${c.code})`;
            opt.dataset.iso = (c.iso2 || '').toUpperCase();
            countrySelect.appendChild(opt);
        });

        // try preselect via navigator locale region (if available)
        try {
            const region = (navigator.language || '').split('-')[1];
            if (region) {
                const opt = [...countrySelect.options].find(o => (o.dataset.iso || '').toUpperCase() === region.toUpperCase());
                if (opt) countrySelect.value = opt.value;
            }
        } catch (e) {}
    }

    populateList(countries);

    // simple type-ahead for the select: accumulate chars and jump to matching option
    (function addTypeAhead() {
        let buffer = '';
        let timeout;
        countrySelect.addEventListener('keydown', (ev) => {
            // ignore navigation keys and control keys
            if (ev.key.length !== 1 || ev.ctrlKey || ev.metaKey || ev.altKey) return;
            buffer += ev.key.toLowerCase();
            clearTimeout(timeout);
            timeout = setTimeout(() => buffer = '', 900);
            const opts = Array.from(countrySelect.options).slice(1); // skip placeholder
            const idx = opts.findIndex(o => o.textContent.toLowerCase().startsWith(buffer));
            if (idx !== -1) {
                countrySelect.selectedIndex = idx + 1;
            }
        });
    })();

    // form submit: validation & combine phone code + number
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        clearError(errEmail); clearError(errPassword);

        const data = {
            schoolEmail: form.schoolEmail.value.trim(),
            firstName: form.firstName.value.trim(),
            middleName: form.middleName.value.trim(),
            lastName: form.lastName.value.trim(),
            studentId: form.studentId.value.trim(),
            phone: '', // will set below
            year: form.year.value,
            program: form.program.value.trim(),
            password: form.regPassword.value,
            confirmPassword: form.confirmPassword.value
        };

        // basic validation
        if (!data.schoolEmail || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.schoolEmail)) {
            showError(errEmail, 'Please enter a valid school / university email.');
            form.schoolEmail.focus();
            return;
        }
        if (!data.firstName || !data.lastName || !data.studentId) {
            alert('Please complete required fields (First name, Last name, Student ID).');
            return;
        }
        if (!data.password || data.password.length < 6) {
            showError(errPassword, 'Password must be at least 6 characters.');
            form.regPassword.focus();
            return;
        }
        if (data.password !== data.confirmPassword) {
            showError(errPassword, 'Passwords do not match.');
            form.confirmPassword.focus();
            return;
        }

        const countryCode = countrySelect.value || '';
        const rawNumber = phoneNumberInput.value.trim();
        if (!countryCode || !rawNumber) {
            alert('Please select a country code and enter your phone number.');
            return;
        }
        data.phone = countryCode + rawNumber.replace(/\s+/g, '');

        // store user locally (demo). Do NOT store plaintext passwords in real apps.
        try {
            const users = JSON.parse(localStorage.getItem('srms_users') || '[]');
            users.push({
                id: data.studentId,
                email: data.schoolEmail,
                name: `${data.firstName} ${data.middleName} ${data.lastName}`.replace(/\s+/g,' ').trim(),
                phone: data.phone,
                year: data.year,
                program: data.program,
                password: data.password
            });
            localStorage.setItem('srms_users', JSON.stringify(users));
        } catch (err) {
            console.error(err);
        }

        // redirect back to login
        window.location.href = 'student-login.html';
    });
});
</script>
</body>
</html>
